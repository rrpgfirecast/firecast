<?xml version="1.0" encoding="UTF-8"?>
<form name="tmpFamiliaridades" height="33" align="top" onShow="formatColors() calcSomaPontosSobre()">
	<style>
	label, edit, radioButton, checkBox, comboBox, button{
		fontSize: 14;
		fontFamily: Cambria;
		textTrimming: character;
	}
	
	textEditor{
		fontSize: 14;
		fontFamily: Cambria;
		margins: {bottom=20};
	}
	
	edit, comboBox, textEditor{
		transparent: true;
	}

	edit, button {
		fontColor: white;
	}

	button {
		cursor: handPoint;
	}

	label, radioButton, checkBox, comboBox{
		fontColor: #cdcdcd;
	}

	radioButton{
		vertTextAlign: center;
		margins: {bottom=7};
	}

	horzLine{
		strokeColor: #424242;
		margins: {top=7, bottom=7};
		align: top;
	}
	
	.pts{
		fontFamily: Courier New;
		fontSize: 10;
		fontColor: #9e9e9e;
		align: left;
		vertTextAlign: leading;
		width: 40;
		transparent: true;
		horzTextAlign: trailing;
	}
	
	</style>
	<script><![CDATA[
		
		local function formatColors()
			local input_text = tostring(sheet.PtsFam) or ""
			local pontos_str = input_text:match("%[([%-]?%d+)%]")
			
			local pontos = tonumber(pontos_str) or 0
			
			if pontos > 0 then
				self.edtPtsFam.fontColor = '#00ff78'
			elseif pontos == 0 then
				self.edtPtsFam.fontColor = '#9e9e9e'
			else
				self.edtPtsFam.fontColor = 'red' 
			end
		end
		
		local function calcSomaPontosSobre()
			local nodoPai = NDB.getParent(NDB.getParent(sheet))
			nodoPai.cbSobreCalc = not nodoPai.cbSobreCalc
		end
	]]></script>
	
	<layout align="top" height="30" margins="{bottom=3}">
		<button align="left" text="ðŸž­" width="30" onClick="NDB.deleteNode(sheet) calcSomaPontosSobre()" hint="Apagar Familiaridade" margins="{right=2}" />
		
		<edit align="right" width="50" name="edtPtsFam" field="PtsFam" class="pts" hint="Pontos Gastos na Familiaridade Cultural">
			<event name="onEnter">
				sheet.PtsFam = nil
				self.edtPtsFam.type = "number"
			</event>
			<event name="onExit">
				self.edtPtsFam.type = "text"
				sheet.PtsFam = string.format('[%02d]', sheet.PtsFam or 0)
			</event>
		</edit>
		<dataLink field="PtsFam" defaultValue="[00]">
			<event name="onChange">
				formatColors()
				calcSomaPontosSobre()
			</event>
		</dataLink>
		
		<edit align="client" field="FamCult" hint="Familiaridade Cultural">
				<event name="onEnter"><![CDATA[
					if sheet.FamCult == "Familiaridade Cultural" or sheet.FamCult == "â€”" then sheet.FamCult = nil end
				]]></event>
				<event name="onExit"><![CDATA[
					if sheet.FamCult == nil then sheet.FamCult = "â€”" end
				]]></event>
			</edit>
		<dataLink field="FamCult" defaultValue="Familiaridade Cultural" />
	</layout>
	
</form>