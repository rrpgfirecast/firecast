<?xml version="1.0" encoding="UTF-8"?>
<form name="tmpDesvantagens" height="33" align="top" onShow="formatColors() calcSomaPontosVantagens()" onMouseEnter="select()" onMouseLeave="select()" hitTest="true">
	<style>
	label, edit, radioButton, checkBox, comboBox, button{
		fontSize: 14;
		fontFamily: Cambria;
		textTrimming: character;
	}
	
	textEditor{
		fontSize: 14;
		fontFamily: Cambria;
		margins: {bottom=20};
	}
	
	edit, comboBox, textEditor{
		transparent: true;
	}

	edit, button {
		fontColor: white;
	}

	button {
		cursor: handPoint;
	}

	label, radioButton, checkBox, comboBox{
		fontColor: #cdcdcd;
	}

	radioButton{
		vertTextAlign: center;
		margins: {bottom=7};
	}

	horzLine{
		strokeColor: #424242;
		margins: {top=7, bottom=7};
		align: top;
	}
	
	.pts{
		fontFamily: Courier New;
		fontSize: 10;
		fontColor: #9e9e9e;
		align: left;
		vertTextAlign: leading;
		width: 40;
		transparent: true;
	}
	
	</style>
	<script><![CDATA[
		
		local function formatColors()
			local input_text = tostring(sheet.PtsVan) or ""
			local pontos_str = input_text:match("%[([%-]?%d+)%]")
			
			local pontos = tonumber(pontos_str) or 0
			
			if pontos > 0 then
				self.edtPtsVan.fontColor = '#00ff78'
			elseif pontos == 0 then
				self.edtPtsVan.fontColor = '#9e9e9e'
			else
				self.edtPtsVan.fontColor = 'red' 
			end
		end
		
		local function calcSomaPontosVantagens()
			local nodoPai = NDB.getParent(NDB.getParent(sheet))
			nodoPai.cbTraCalc = not nodoPai.cbTraCalc
		end
		
		local function desc()
			local tipo = sheet.TipoVan
			if tipo == nil then tipo = "Nenhum" end
			
			local cat = sheet.catVan
			if cat == "â€”" then cat = "Mundana" end
			
			sheet.TipoeCat = cat .. "/" .. tipo
			
			local mesaDoPersonagem = Firecast.getMesaDe(sheet);
			local meuJogador = mesaDoPersonagem.meuJogador
			local meuNick = meuJogador.nick
			
			local msg = "ðŸ’¬ ".. meuNick .."[Â§R][Â§K2] destacou a Desvantagem:"
			msg = msg .. "\n****\n### [Â§K1][Â§B]".. (sheet.nomeVan or "") .."[Â§B]\n###### ".. (sheet.TipoeCat or "")
			msg = msg .. "\n [Â§K1][Â§B]Description:[Â§B] [Â§K14]".. (sheet.descVan or "")
			msg = msg .. "[Â§T]\n****"

			mesaDoPersonagem.activeChat:enviarMensagem(msg)
		end
		
		local function select()
			self.recHighlight.visible = not self.recHighlight.visible
		end
	]]></script>
	
	<rectangle color="#202020" width="498" />
	<rectangle color="#202020" left="798" width="230" onMouseEnter="select()" onMouseLeave="select()" hitTest="true" />
	<rectangle color="#303030" width="2000" height="33" visible="false" name="recHighlight"/>
	
	<layout align="top" height="30" margins="{top=3}">
		<button align="left" width="30" text="ðŸ’¬" margins="{right=3}" onClick="desc()" hint="Enviar DescriÃ§Ã£o no Chat" onMouseEnter="select()" onMouseLeave="select()" hitTest="true" />
		
		<edit align="left" width="465" fontStyle="bold" name="edtNomeVan" field="nomeVan" hint="Nome da Peculiaridade" onMouseEnter="select()" onMouseLeave="select()" hitTest="true" />
		<dataLink field="nomeVan" defaultValue="â€”" />
		
		<comboBox align="left" width="150" name="edtCatVan" items="{'â€”', 'ExÃ³tica', 'Sobrenatural'}" field="catVan" hint="Categoria da Peculiaridade" onMouseEnter="select()" onMouseLeave="select()" hitTest="true" />
		<dataLink field="catVan" defaultValue="â€”" />
		
		<comboBox align="left" width="150" name="edtTipoVan" items="{'Mental', 'FÃ­sica', 'Social'}" field="TipoVan" hint="Tipo da Peculiaridade" onMouseEnter="select()" onMouseLeave="select()" hitTest="true" />
		<dataLink field="tipoVan" />
		
		<edit align="left" width="50" name="edtPtsVan" field="PtsVan" class="pts" hint="Pontos Gastos na Desvantagem" onMouseEnter="select()" onMouseLeave="select()" hitTest="true">
			<event name="onEnter">
				sheet.PtsVan = nil
				self.edtPtsVan.type = "number"
			</event>
			<event name="onExit">
				self.edtPtsVan.type = "text"
				sheet.PtsVan = string.format('[%02d]', sheet.PtsVan or 0)
			</event>
		</edit>
		<dataLink field="PtsVan" defaultValue="[00]">
			<event name="onChange">
				calcSomaPontosVantagens()
				formatColors()
			</event>
		</dataLink>
		
		<button align="left" text="ð¢" width="30" name="btnInfo" hint="InformaÃ§Ãµes Extras" onMouseEnter="select()" onMouseLeave="select()" hitTest="true">
			<event name="onClick"><![CDATA[
				local pop = self:findControlByName("popUp_");
						
				if pop ~= nil then
					pop:showPopupEx("left", self.btnInfo);
					pop:setNodeObject(sheet);
					
					local tipo = sheet.TipoVan
					if tipo == nil then tipo = "Nenhum" end
					
					local cat = sheet.catVan
					if cat == "â€”" then cat = "Mundana" end
					
					sheet.TipoeCat = cat .. "/" .. tipo
				else
					showMessage("Ops, nÃ£o encontrei o pop-up para exibir");
				end;
			]]></event>
		</button>
		
		<template name="DivisorM">
			<layout align="top" height="12" margins="{top=0, bottom=5}">
				<label align="left" text="$(texto)" width="$(largura)" fontSize="10" fontFamily="Constantia" fontStyle="bold" />
				<horzLine align="client" margins="{top=5}" strokeColor="#424242" />
			</layout>
		</template>
		
		<popup name="popUp_" width="518" height="447" backOpacity="0" drawContainer="false" autoScopeNode="false">
			<rectangle align="client" color="#101010" padding="{top=5, left=5, bottom=5, right=5}" xradius= "10" yradius="10" cornerType="bevel">
				<rectangle align="client" color="#101010" padding="{top=15, left=15, bottom=15, right=0}" xradius= "7" yradius="7" cornerType="bevel" strokeSize="1" strokeColor="#424242">
					<layout align="top" height="40">
						<label field="nomeVan" align="client" textTrimming="character" fontStyle="bold" fontColor="white" fontSize="20" />
						<label field="TipoeCat" align="right" horzTextAlign="trailing" width="150" margins="{right=15}" />
					</layout>
					<scrollBox align="client" padding="{bottom=0, right=15}">
						<DivisorM texto="D E S C R I P T I O N" largura="95" />
						<textEditor field="descVan" align="top" height="290"/>
						<button text="ðŸ’¬" align="top" height="30" hint="Enviar DescriÃ§Ã£o no Chat" onClick="desc()" />
					</scrollBox>
				</rectangle>
			</rectangle>
		</popup>
		
		<button align="left" text="ðŸž­" width="30" onClick="NDB.deleteNode(sheet) calcSomaPontosVantagens()" hint="Apagar Desvantagem" margins="{left=2}" onMouseEnter="select()" onMouseLeave="select()" hitTest="true" />
		
	</layout>
</form>