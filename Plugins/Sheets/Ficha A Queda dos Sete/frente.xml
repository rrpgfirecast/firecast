<?xml version="1.0" encoding="UTF-8"?>
<rectangle class="fundo">
	<script>
		<![CDATA[
		require("locale.lua");
	
		function self:sortSkillBoxesOf(attrName)	
			local sortData = self.__attrSortData;
			
			if sortData == nil then
				return;
			end;
			
			local attrSortData = sortData[attrName];
			
			if attrSortData == nil then
				return;
			end;
			
			table.sort(attrSortData,
				function (left, right)
					local leftStr = Locale.eval(left.title);
					local rightStr = Locale.eval(right.title);				
					return Utils.compareStringPtBr(leftStr, rightStr) < 0;
				end);
				
			for i = 1, #attrSortData, 1 do
				local ctrl = self:findControlByName(attrSortData[i].controlName);
				
				if ctrl ~= nil then
					local previousParent = ctrl:getParent();
					ctrl:setParent(nil);
					ctrl:setParent(previousParent);				
				end;
			end;			
		end;
	
		function self:sortFrontSkillBoxes()	
			self:sortSkillBoxesOf("forca");
			self:sortSkillBoxesOf("destreza");
			self:sortSkillBoxesOf("constituicao");
			self:sortSkillBoxesOf("inteligencia");
			self:sortSkillBoxesOf("sabedoria");
			self:sortSkillBoxesOf("carisma");
		end;
		
		]]>
	</script>

	<scrollBox align="client">		
		<flowLayout class="tile" align="top" height="500" margins="{left=10, right=10, top=10}" autoHeight="true" horzAlign="center" lineSpacing="2" name="fraFrenteLayout">
			<!-- PARTE SUPERIOR DA FRENTE -->
			<flowLayout class="oneLineTile" autoHeight="true" minScaledWidth="290" horzAlign="center">
				<!-- NOME DO PERSONAGEM -->				
				
				<flowPart name="flwNome1" minWidth="320" maxWidth="1600" frameStyle="frames/banner/heroGroup.xml" height="175" vertAlign="center" avoidScale="true">							
					<layout align="client" name="layNomeHolderFrente">
							<edit name="edtNome1" field="nome" class="transparente vcenter" fontSize="17" align="client"/>
							<label margins="{left=3}" name="labNome1" align="bottom" text="@@DnD5e.frente.lab.characterName" class="tituloCampo" autoSize="true"/>
					</layout>
				</flowPart>								

				<!-- GRID DE INFORMACOES SUPERIORES DA FRENTE -->
				<flowLayout  minWidth="320" maxWidth="1600" name="fraUpperGridFrente" avoidScale="true" frameStyle="frames/upperInfoGrid/frame.xml" autoHeight="true" vertAlign="trailing" maxControlsPerLine="3">								
						<upperGridCampo field="classeENivel" minWidth="100" titulo="@@DnD5e.frente.lab.classaLevel"/>
						<upperGridCampo field="antecedentes" titulo="@@q7.past"/>
						<upperGridCampo field="nomeDoJogador" titulo="@@DnD5e.frente.lab.player"/>									
						<upperGridCampo field="raca" minWidth="100" titulo="@@DnD5e.frente.lab.race"/>
						<upperGridCampo field="tendencia" titulo="@@q7.vision"/>
						<upperGridCampo field="experiencia.valor" titulo="@@q7.city"/>
				</flowLayout>
			</flowLayout>							
			<flowLineBreak/>
			
			<!-- SEGUNDA PARTE -->
			
			<flowLayout class="oneLineTile" horzAlign="justify" autoHeight="true" avoidScale="true">
				
				
				<!-- BONUS PROFICIENCIA -->
				<flowPart minWidth="280" maxWidth="800" height="64" frameStyle="frames/posCaptionEdit2/frame.xml">
					<edit align="left" class="pericia" field="bonusProficiencia" width="70"/>
					<label align="client" text="@@DnD5e.frente.lab.proficiencyBonus" margins="{left=10}" class="tituloCampo" horzTextAlign="center"/>
				</flowPart>
				
				
				<!-- BONUS HABILIDADES -->
				<flowPart minWidth="280" maxWidth="800" height="64" frameStyle="frames/posCaptionEdit2/frame.xml">
					<edit align="left" class="pericia" field="percepcaoPassiva" width="70"/>
					<label align="client" text="@@q7.perception" margins="{left=10}" class="tituloCampo" horzTextAlign="center"/>
				</flowPart>
				
				
				<!-- BONUS RESISTENCIAS -->
				<flowPart minWidth="280" maxWidth="800" height="64" frameStyle="frames/posCaptionEdit2/frame.xml">
					<edit align="left" class="pericia" field="sensibilidadePassiva" width="70"/>
					<label align="client" text="@@q7.sensitivy" margins="{left=10}" class="tituloCampo" horzTextAlign="center"/>
				</flowPart>
			</flowLayout>
			
			<flowLineBreak/>
			<!-- TERCEIRA PARTE -->
			
			<flowLayout autoHeight="true" class="oneLineTile" minScaledWidth="290" horzAlign="center">
			<!-- ATRIBUTOS -->
			
				<flowLayout name="fraLayAtributos" class="tile" vertAlign="leading" autoHeight="true" minScaledWidth="290" maxControlsPerLine="3" horzAlign="center"
							lineSpacing="10" frameStyle="frames/panel1/frame.xml" 
							margins="{left=2, top=2, right=16, bottom=4}" avoidScale="true">
					<boxAtributo titulo="@@DnD5e.frente.box.strength" field="forca">
						{{"@@DnD5e.skills.athletics", "atletismo"},
						 {"Artes Marciais", "artesmarciais"}}
					</boxAtributo>
					
					<boxAtributo titulo="AGILIDADE" field="destreza">
						{{"Acrobacia", "acrobacia"},
						 {"@@DnD5e.skills.stealth", "furtividade"},
						 {"@@DnD5e.skills.sleighthand", "prestidigitacao"},
						 {"Reflexo", "reflexo"}}
					</boxAtributo>
					
					<boxAtributo titulo="VITALIDADE" field="constituicao">
						{{"Restauração", "restauracao"},
						{"Vigor", "vigor"}}
					</boxAtributo>

					<boxAtributo titulo="@@DnD5e.frente.box.intelligence" field="inteligencia">
						{{"Abismo", "arcanismo"}, 
						 {"Herbalismo", "herbalismo"},
						 {"@@DnD5e.skills.history", "historia"},
						 {"@@DnD5e.skills.investigation", "investigacao"},
						 {"Medicina", "medicina"},
						 {"Tecnologia", "tecnologia"}}
					</boxAtributo>
					
					<boxAtributo titulo="INSTINTO" field="sabedoria">
						{{"Aura", "aura"},
						 {"@@DnD5e.skills.insight", "intuicao"},
						 {"@@DnD5e.skills.perception", "percepcao"},
						 {"Resiliência Mental", "resilienciamental"},
						 {"@@DnD5e.skills.survival", "sobrevivencia"}}
					</boxAtributo>
					
					<boxAtributo titulo="ENERGIA" field="carisma">
						{{"Visão Elemental", "visaoelemental"}, 
						 {"Sensibilidade", "sensibilidade"},
						 {"Canalização", "canalizacao"},
						 {"Manipulação", "manipulacao"}}
					</boxAtributo>
				</flowLayout>
				
				<script>
					self:sortFrontSkillBoxes();
				</script>
				
				<!-- segunda coluna -->
				
				<flowLayout autoHeight="true" horzAlign="center" vertAlign="leading" 
							class="halfTile" maxControlsPerLine="1">
					<flowPart class="tileCarac" height="300" frameStyle="frames/panel5/frame.xml" margins="{left = 0, right = 4}">
						<image align="client" style="proportional" field="imagens.aparencia" class="transparente" margins="{top=2}" editable="true" animate="true"/>
						<label align="bottom" autoSize="true" text="@@DnD5e.features.appearance" fontSize="12" vertTextAlign="center" horzTextAlign="center" fontStyle="bold"/>
					</flowPart>

					<!-- CA, Iniciativa e Deslocamento -->
					
					<flowLayout minWidth="235" maxWidth="475" autoHeight="true" avoidScale="false" vertAlign="center" horzAlign="justify">
							<!-- CA -->
							<flowPart stepSizes="{105}" minScaledWidth="75" height="120" frameStyle="frames/shield/frame.xml">
								<label align="top" text="DEFESA" height="20" fontSize="9" wordWrap="true" horzTextAlign="center" textTrimming="none"/>
								<edit align="client" class="atributo transparente" field="CA" fontSize="30"/>	
								<dataLink fields="{'atributos.moddestrezastr', 'bonusProficiencia'}">
									<event name="onChange">
										if sheet==nil then return end
										if sheet.atributos==nil then return end
										
										local modDex = tonumber(sheet.atributos.moddestrezastr) or 0;
										local prof = tonumber(sheet.bonusProficiencia) or 0;
										
										sheet.CA = 10 + modDex + prof;
									</event>
								</dataLink>
							</flowPart>
							
							<!-- INICIATIVA -->
							<flowPart stepSizes="{105}" minScaledWidth="75" height="120" frameStyle="frames/panel4transp/frame.xml">
								<label align="top" text="INICIATIVA" height="20" fontSize="9" wordWrap="true" horzTextAlign="center" textTrimming="none"/>
								<edit name="initiativeVal" align="client" class="atributo transparente" field="iniciativa" fontSize="30"/>	
							</flowPart>		

							<!-- DESLOCAMENTO -->

							<flowPart stepSizes="{105}" minScaledWidth="75" height="120" frameStyle="frames/panel4transp/frame.xml">
								<label align="top" text="@@DnD5e.frente.lab.displacement" height="20" fontSize="9" wordWrap="true" horzTextAlign="center" textTrimming="none"/>
								<edit align="client" class="atributo transparente" field="deslocamento" fontSize="30"/>	
							</flowPart>	
					</flowLayout>		

					<!-- PONTOS DE VIDA -->
					<flowPart minWidth="235" maxWidth="475" minScaledWidth="200" height="175" margins="{left=2, right=2, top=4, bottom=8}">
					<!-- PONTOS DE VIDA ATUAL -->
						<frame align="client" frameStyle="frames/panel5/topPanel.xml" margins="{left = 4, right = 4, bottom=4}">
							<layout align="top" height="25">
								<label align="left" class="tituloCampo" autoSize="true" text="@@DnD5e.frente.lab.PVMax" textTrimming="none" wordWrap="false" fontSize="12" horzTextAlign="trailing"/>
								<layout align="client" margins="{left=5, right=3}">
									<edit align="client" class="transparente" field="PVMax" vertTextAlign="center" horzTextAlign="center"/>
									<horzLine align="bottom" strokeColor="gray"/>
								</layout>
							</layout>
							<edit align="client" field="PV" class="transparente" margins="{top=2}" horzTextAlign="center" vertTextAlign="center" fontSize="36" fontStyle="bold"/>
							<label align="bottom" autoSize="true" text="@@DnD5e.frente.lab.PVCurrent" fontSize="11" vertTextAlign="center" horzTextAlign="center" fontStyle="bold"/>
						</frame>
					</flowPart>			
				</flowLayout>	
			</flowLayout>
		</flowLayout>	
	</scrollBox>
</rectangle>	